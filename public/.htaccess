<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
  # ── Detect social bots (Slack, FB, Twitter, LinkedIn, WhatsApp, Telegram, Discord, Pinterest, Skype) ──
  SetEnvIfNoCase User-Agent "Slackbot|facebookexternalhit|Twitterbot|LinkedInBot|WhatsApp|TelegramBot|Discordbot|Pinterest|SkypeUriPreview" IS_SOCIAL_BOT=1
  # === Bot-only proxies to backend (order matters: most specific first) ===
  # 1) Cuisine page: /:country/:city/restaurants/cuisine/:slug/:id
  RewriteCond %{ENV:IS_SOCIAL_BOT} =1
  RewriteRule ^([a-z]{2})/([^/]+)/restaurants/cuisine/([^/]+)/(\d+)$ http://backend.fomino.ch:3080/$1/$2/restaurants/cuisine/$3/$4 [P,L]
 RewriteCond %{ENV:IS_SOCIAL_BOT} =1
  RewriteRule ^([a-z]{2})/([^/]+)/stores/cuisine/([^/]+)/(\d+)$ http://backend.fomino.ch:3080/$1/$2/stores/cuisine/$3/$4 [P,L]
  # 2) STORE product page: /:country/:city/stores/:storeSlug/:productSlug
  RewriteCond %{ENV:IS_SOCIAL_BOT} =1
  RewriteRule ^([a-z]{2})/([^/]+)/stores/([^/]+)/([^/]+)$ http://backend.fomino.ch:3080/$1/$2/stores/$3/$4 [P,L]
  # 3) RESTAURANT product page: /:country/:city/restaurants/:restaurantSlug/:productSlug
  RewriteCond %{ENV:IS_SOCIAL_BOT} =1
  RewriteRule ^([a-z]{2})/([^/]+)/restaurants/([^/]+)/([^/]+)$ http://backend.fomino.ch:3080/$1/$2/restaurants/$3/$4 [P,L]
  # 4) STORE page: /:country/:city/stores/:slug
  RewriteCond %{ENV:IS_SOCIAL_BOT} =1
  RewriteRule ^([a-z]{2})/([^/]+)/stores/([^/]+)$ http://backend.fomino.ch:3080/$1/$2/stores/$3 [P,L]
  # 5) RESTAURANT page: /:country/:city/restaurants/:slug
  RewriteCond %{ENV:IS_SOCIAL_BOT} =1
  RewriteRule ^([a-z]{2})/([^/]+)/restaurants/([^/]+)$ http://backend.fomino.ch:3080/$1/$2/restaurants/$3 [P,L]
   # 5) RESTAURANT page: /:country/:city/restaurants/:slug
  RewriteCond %{ENV:IS_SOCIAL_BOT} =1
  RewriteRule ^([a-z]{2})/([^/]+)/stores/([^/]+)$ http://backend.fomino.ch:3080/$1/$2/restaurants/$3 [P,L]
  # Group Order page: /group-order?id=...&hid=...
RewriteCond %{ENV:IS_SOCIAL_BOT} =1
RewriteRule ^group-order$ http://backend.fomino.ch:3080/group-order [P,L,QSA]
  # === SPA fallback for humans (serve index.html if no real file/dir) ===
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^ index.html [L]
</IfModule>
